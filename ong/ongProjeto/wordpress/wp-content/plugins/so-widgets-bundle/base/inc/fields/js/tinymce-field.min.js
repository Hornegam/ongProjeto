!function(w){function t(r){if(!r.data("initialized")){var i=wp.oldEditor?wp.oldEditor:wp.editor;i&&i.hasOwnProperty("autop")&&(wp.editor.autop=i.autop,wp.editor.removep=i.removep,wp.editor.initialize=i.initialize);var e,n=r.find(".siteorigin-widget-tinymce-container"),c=n.data("editorSettings");if(tinyMCEPreInit.mceInit&&tinyMCEPreInit.mceInit.hasOwnProperty("content")){var t=tinyMCEPreInit.mceInit.content;if(t.hasOwnProperty("content_css")&&t.content_css){var o=t.content_css.split(",");if(c.tinymce.hasOwnProperty("content_css")&&c.tinymce.content_css)for(var s=0;s<o.length;s++){var a=o[s];-1===c.tinymce.content_css.indexOf(a)&&(c.tinymce.content_css+=","+a)}else c.tinymce.content_css=o}}if(c.wpautopToggleField){var d=n.closest(".siteorigin-widget-form");e=d.find(c.wpautopToggleField),c.tinymce.wpautop=e.is(":checked")}var l=n.find("textarea"),f=l.attr("id");if(c.tinymce&&(c.tinymce=w.extend({},c.tinymce,{selector:"#"+f,setup:function(i){i.on("change",function(){window.tinymce.get(f).save(),l.trigger("change")}),e&&(e.off("change"),e.on("change",function(){wp.editor.remove(f),c.tinymce.wpautop=e.is(":checked"),wp.editor.initialize(f,c)}))}})),w(document).on("wp-before-tinymce-init",function(i,e){if(e.selector===c.tinymce.selector){var t=n.data("mediaButtons");0===r.find(".wp-media-buttons").length&&r.find(".wp-editor-tabs").before(t.html)}}),w(document).on("tinymce-editor-setup",function(){var i=r.find(".wp-editor-wrap");0<i.length&&!i.hasClass(c.selectedEditor+"-active")&&setTimeout(function(){window.switchEditors.go(f)},10)}),i.remove(f),window.tinymce&&window.tinymce.EditorManager.overrideDefaults({base_url:c.baseURL,suffix:c.suffix}),l.is(":visible"))i.initialize(f,c);else var m=setInterval(function(){l.is(":visible")&&(i.initialize(f,c),clearInterval(m))},500);r.on("click",function(i){var e=w(i.target);if(e.is(".wp-switch-editor")){var t=e.hasClass("switch-tmce")?"tmce":"html";if("tmce"==t){var n=window.tinymce.get(f);if(null!==n){var o=l.val();-1!==o.search("<")&&-1===o.search(">")&&(o=o.replace(/</g,""),l.val(o)),n.setContent(window.switchEditors.wpautop(o))}}c.selectedEditor=t,r.find(".siteorigin-widget-tinymce-selected-editor").val(t)}}),r.data("initialized",!0)}}w(document).on("sowsetupformfield",".siteorigin-widget-field-type-tinymce",function(){var i=w(this),e=i.closest(".siteorigin-widget-field-repeater-item-form");0<e.length?e.is(":visible")?t(i):e.on("slideToggleOpenComplete",function(){e.is(":visible")&&(t(i),e.off("slideToggleOpenComplete"))}):t(i)}),w(document).on("sortstop",function(i,e){(e.item.is(".siteorigin-widget-field-repeater-item")?e.item.find("> .siteorigin-widget-field-repeater-item-form"):e.item.find(".siteorigin-widget-form")).find(".siteorigin-widget-field-type-tinymce").each(function(){w(this).data("initialized",null),t(w(this))})})}(jQuery);