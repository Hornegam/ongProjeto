var sowb=window.sowb||{};jQuery(function(_){sowb.setupCarousel=function(){_(".sow-carousel-wrapper").each(function(){function u(){w<0&&(w=c?c-1:0),w===c&&(w=0);var e=Math.ceil(t.outerWidth()/d);if(w+e>=t.find(".sow-carousel-item").length-1&&!r&&!f){r=!0,i++,n.append('<li class="sow-carousel-item sow-carousel-loading"></li>');var s=a.find('input[name="instance_hash"]').val();_.get(t.data("ajax-url"),{query:t.data("query"),action:"sow_carousel_load",paged:i,instance_hash:s},function(e,s){_(e.html).appendTo(n).hide().fadeIn(),t.find(".sow-carousel-loading").remove(),c=t.find(".sow-carousel-item").length,f=c===l,r=!1})}n.css("transition-duration","0.45s"),n.css(h,-d*w+"px")}var t=_(this),e=t.closest(".sow-carousel-container"),a=t.closest(".sow-carousel-container").parent(),n=t.find(".sow-carousel-items"),s=t.find(".sow-carousel-item"),o=s.eq(0),w=0,i=1,r=!1,c=s.length,l=t.data("found-posts"),f=c===l,d=o.width()+parseInt(o.css("margin-right")),p=e.hasClass("js-rtl"),h=p?"margin-right":"margin-left";if(a.on("click","a.sow-carousel-previous",function(e){e.preventDefault(),w-=p?-1:1,u()}),a.on("click","a.sow-carousel-next",function(e){e.preventDefault(),w+=p?-1:1,u()}),"function"==typeof t.swipe){function g(e){return e<50&&-d*c<e&&(n.css("transition-duration","0s"),n.css(h,e+"px"),!0)}function v(){var e=parseInt(n.css(h));w=Math.abs(Math.round(e/d)),u()}var m,b=!1,D=0,I=0,T=0,x=0,M=p?"right":"left";t.on("click",".sow-carousel-item a",function(e){b&&(e.preventDefault(),b=!1)}),t.swipe({excludedElements:"",triggerOnTouchEnd:!0,threshold:75,swipeStatus:function(e,s,a,n,t,o,i){if("up"===a||"down"===a)return!1;if("start"===s)I=-d*w,x=(new Date).getTime(),clearInterval(m);else if("move"===s){a===M&&(n*=-1),g(I+n);var r=(new Date).getTime();T=(n-D)/((r-x)/1e3),x=r,D=n}else if("end"===s)if(b=!0,a===M&&(n*=-1),400<Math.abs(T)){T*=.1;var c=(new Date).getTime(),l=0;m=setInterval(function(){var e=((new Date).getTime()-c)/1e3,s=I+n+(l+=T*e),t=Math.abs(T)-30<0;a===M?T+=30:T-=30,!t&&g(s)||(clearInterval(m),v())},20)}else v();else"cancel"===s&&u()}})}})},sowb.setupCarousel(),_(sowb).on("setup_widgets",sowb.setupCarousel)}),window.sowb=sowb;